\documentclass{article}
\usepackage{titlesec}
\usepackage{colortbl}
\usepackage{tabularx}
\usepackage[utf8]{inputenc}

\title{Assignment T2. Peer-To-Peer Network Systems \\
\large TDT4190 - Distributed Systems, spring 2014}

\author{
    Sigve Sebastian Farstad \\
    Christoffer TÃ¸nnessen
}

\renewcommand\thesubsection{\alph{subsection})}
\newcommand{\question}[1]{\subsection{}\textit{#1}\bigskip}

\begin{document}

\maketitle

\section{Theory}

\question{In a distributed system with high churn, participating nodes leave and join the system all the times. Is peer-to-peer network or client-server best suited to withstand the high churn? Explain your answer.}

In a peer-to-peer network the role of every node is the same.
When there is a high churn, every node connects itself to others and it doesn't matter who.
This makes for an even distribution of the workload.
In a client-server network all nodes have to connect to the one server.
When a high churn occurs, the workload on the server will increase.
This means the server must spend more time on the nodes connecting and disconnecting.

A peer-to-peer network is therefor better than a client-server network when there is a high churn.

\question{Why are searches in structured peer-to-peer networks limited to lookups on key (which is GUID), while searches in unstructured peer-to-peer network can be anything?}

In structured peer-to-peer networks, the network is organized into a specific topology.
Commonly, this topology is a type of DHT, or Distributed Hash Table.
As hash tables look up values based on a key, it follows naturally that most structured peer-to-peer networks are limited to lookups on keys.

Unstructured peer-to-peer networks, on the other hand, do not implement any efficient distributed global key lookup mechanism.
This means that searches in unstructured peer-to-peer networks need to flood through the network in order to reach as many nodes as possible.
Since key-based lookup provides no advantage in this case, searches might as well be anything.

\section{Practical}

\question{Takes as a starting point a Pastry Network with 12-bit GUID. Suppose there are 25 peers with the following GUIDs: F9C, F89, BFC, BA0, AAE, A7C, 7D9, 7D7, 7D5, 7D4, 4CC, 4CF, 4C1, 4A7, 48E, 39C, 33F, 371, 328, 1EC, 19E, 11E, 170, 129, 0FB. Create the routing tables of the nodes 4CC and 7D9. Each cell in the routing tables will contain either nothing or GUID of a node}

We choose $b = 2$ for this assignment. This means we need to change the numbers into base 4. The benefit of this is that we get a nice 3 by 3 table for the routing table. This is done in table \ref{tab:b16b4conv} .

The routing table for node 4CC can be found in table \ref{tab:route103030} and for node 7D9 in table \ref{tab:route133121} .

\begin{table}[ht!]
    \begin{center}
    \begin{tabular}{| l | l |}
    \hline
    \bf{Hex}  & \bf{Base 4} \\
    \hline
    F9C         & $ 332130_4 $ \\
    \hline
    F89         & $ 332021_4 $ \\
    \hline
    BFC         & $ 233330_4 $ \\
    \hline
    BA0         & $ 232200_4 $ \\
    \hline
    AAE         & $ 222232_4 $ \\
    \hline
    A7C         & $ 221330_4 $ \\
    \hline
    7D9         & $ 133121_4 $ \\
    \hline
    7D7         & $ 133113_4 $ \\
    \hline
    7D5         & $ 133111_4 $ \\
    \hline
    7D4         & $ 133110_4 $ \\
    \hline
    4CC         & $ 103030_4 $ \\
    \hline
    4CF         & $ 103033_4 $ \\
    \hline
    4C1         & $ 103001_4 $ \\
    \hline
    4A7         & $ 102213_4 $ \\
    \hline
    48E         & $ 102032_4 $ \\
    \hline
    39C         & $ 032130_4 $ \\
    \hline
    33F         & $ 030333_4 $ \\
    \hline
    371         & $ 031301_4 $ \\
    \hline
    328         & $ 030220_4 $ \\
    \hline
    1EC         & $ 013230_4 $ \\
    \hline
    19E         & $ 012132_4 $ \\
    \hline
    11E         & $ 010132_4 $ \\
    \hline
    170         & $ 011300_4 $ \\
    \hline
    129         & $ 010221_4 $ \\
    \hline
    0FB         & $ 003323_4 $ \\
    \hline
    \end{tabular}
    \caption{Base 16 to base 4 conversion for node values}
    \label{tab:b16b4conv}
    \end{center}
\end{table}

\begin{table}[ht!]
    \begin{center}
        \begin{tabularx}{.75\textwidth}{| >{\centering} X | >{\centering} X | >{\centering\arraybackslash} X |}
    \hline
    \multicolumn{3}{|c|}{\textbf{Routing table for node $ 103030_4 $}} \\
    \hline
    -3-32130 & -3-32021 & -2-33330 \\
    \hline
    1-3-3121 & 1-3-3113 & 1-3-3111 \\
    \hline
    10-2-213 & 10-2-032 & \cellcolor[gray]{0.8} - \\
    \hline
    \end{tabularx}
    \caption{Routing table for node $ 103030_4 $}
    \label{tab:route103030}
    \end{center}
\end{table}

\begin{table}[ht!]
    \begin{center}
        \begin{tabularx}{.75\textwidth}{| >{\centering} X | >{\centering} X | >{\centering\arraybackslash} X |}
    \hline
    \multicolumn{3}{|c|}{\textbf{Routing table for node $ 133121_4 $}} \\
    \hline
    -0-30333 & -2-21330 & -3-32130 \\
    \hline
    1-0-2213 & 1-0-3030 & 1-0-2032 \\
    \hline
    \cellcolor[gray]{0.8} - & \cellcolor[gray]{0.8} - & \cellcolor[gray]{0.8} - \\
    \hline
    \end{tabularx}
    \caption{Routing table for node 133121}
    \label{tab:route133121}
    \end{center}
\end{table}

\question{Use the routing table from 2a) to show what happens if the node 7D9 wants to perform a lookup on the value 371. Explain what happens. Assume that each node has a leaf node table of size 2 - that is, each node in addition to the routing table only know about their nearest neighbors with higher GUID and nearest neighbor with lower GUID. Describe any other assumptions you make if any.}

First, the node 7D9 ($ 133121_4 $) checks to see if it can find the destination value 371 ($ 031301_4 $) in its leaf set.
The leaf set of 7D9 contains the nodes A7C ($ 221330_4 $) and 7D7 ($ 133113_4 $).
371 ($ 031301_4 $) is not in this range.
Therefore, the node must use its routing table.
The node tries to look up a destination node that shares at least one more common prefix digit with 371 that itself.
7D9 ($ 133121_4 $) shares no common prefix digits with 371 ($ 031301_4 $).
It is therefore sufficient to find a node in the routing table with one more common prefix digit.
In this example, node 33F ($ 030333_4 $) is selected, and the message is passed on to it.

Now, node 33F ($ 030333_4 $) must continue routing the message to its destination.
It first checks to see if it can find the destination value in its leaf set.
The leaf set of 33F ($ 030333_4 $) contains 371 ($ 031301_4 $) and 39C ($ 032130_4 $).
$ 371 $ is the destination node, so the message is sent directly to it.

Answering 7D9's request, 371 replies to 7D9 using a similar process.


\question{A node with GUID 0FC contacts node 7D9 with a desire to join the Pastry network. What happens?}

When a new node wants to join a Pastry network, it's assumed that it knows about at least one other node in the network. The node then asks to join the network.
The node which asks to join the network is believed to be in a close proximity of the requested node.
The requested node updates its routing table and if necessary its leaf node table. It also asks other close nodes to update its tables.
When this is done the node requesting to join can make its own tables based on the feedback from the other nodes.
When this is done the node is a part of the network.

\question{A node has lost connectivity to the network (i.e. the node is "dead" and is no longer available). Describe the most important things that will now happen.}

A node in the Pastry network is considered dead when its immediate neighbors in the node id space can no longer communicate with it.
When this happens, the network needs to eliminate the node from its records.

When a healthy node discovers that one of the nodes in its leaf set is dead, it replaces the dead node with a node from the leaf set of the live node with the largest index on the side of the failed node.

When a healthy node discovers that one of the nodes in its routing table is dead, it routes the message to a different node, and tries to replace the dead node in its routing table.
It does this by asking other similar nodes in its routing table for fitting replacements from their routing tables.

\end{document}
